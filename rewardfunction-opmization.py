import numpy as np
from numpy import exp
import math
def reward_function(params):
    '''
    Speed: [ 0.9 : 1.6] m/s
    waypointList: 1250-0.9
    time: 45min
    '''
    waypointList = np.array([[ 4.08849949e+00,  8.63541037e-01,  4.91250749e+00,
     8.11260211e-01,  5.05151105e+00,  8.63541037e-01,
     6.01449949e+00,  8.63541037e-01],
   [ 4.08846444e+00,  1.16529298e+00,  4.88406317e+00,
     1.08967839e+00,  5.05148792e+00,  1.16529298e+00,
     6.01446444e+00,  1.16529298e+00],
   [ 4.08844250e+00,  1.46704400e+00,  4.84722906e+00,
     1.36444745e+00,  5.05144095e+00,  1.46704400e+00,
     6.01444250e+00,  1.46704400e+00],
   [ 4.08844418e+00,  1.76929107e+00,  4.80204455e+00,
     1.63506883e+00,  5.05144405e+00,  1.76879650e+00,
     6.01444393e+00,  1.76830194e+00],
   [ 4.08859924e+00,  2.06990621e+00,  4.74831035e+00,
     1.90100301e+00,  5.05159903e+00,  2.07055449e+00,
     6.01459881e+00,  2.07120278e+00],
   [ 4.08840183e+00,  2.36891829e+00,  4.68632268e+00,
     2.16205401e+00,  5.05139589e+00,  2.37230003e+00,
     6.01438996e+00,  2.37568176e+00],
   [ 4.08734800e+00,  2.67875010e+00,  4.61592465e+00,
     2.41781510e+00,  5.05033636e+00,  2.67401600e+00,
     6.01332472e+00,  2.66928190e+00],
   [ 4.08902274e+00,  2.99557632e+00,  4.53661638e+00,
     2.66766354e+00,  5.05182004e+00,  2.97581899e+00,
     6.01461734e+00,  2.95606166e+00],
   [ 4.09562194e+00,  3.24364007e+00,  4.44755706e+00,
     2.91071519e+00,  5.05801654e+00,  3.27778149e+00,
     6.02041114e+00,  3.31192291e+00],
   [ 4.10281171e+00,  3.39137591e+00,  4.34732930e+00,
     3.14559499e+00,  5.04732490e+00,  3.57916260e+00,
     5.99183808e+00,  3.76694928e+00],
   [ 4.10681205e+00,  3.48731975e+00,  4.23420157e+00,
     3.37055795e+00,  4.98865366e+00,  3.87426209e+00,
     5.87049527e+00,  4.26120443e+00],
   [ 4.07527791e+00,  3.60274063e+00,  4.10589918e+00,
     3.58322877e+00,  4.86766052e+00,  4.15000546e+00,
     5.66004314e+00,  4.69727029e+00],
   [ 4.00360113e+00,  3.72902127e+00,  3.95966276e+00,
     3.78046954e+00,  4.69657707e+00,  4.39771652e+00,
     5.38955301e+00,  5.06641178e+00],
   [ 3.89497615e+00,  3.85529680e+00,  3.79175257e+00,
     3.95749567e+00,  4.48732209e+00,  4.61456966e+00,
     5.07966803e+00,  5.37384253e+00],
   [ 3.75906488e+00,  3.97130932e+00,  3.60659270e+00,
     4.11708678e+00,  4.24969900e+00,  4.79995108e+00,
     4.74033312e+00,  5.62859283e+00],
   [ 3.58642198e+00,  4.07932806e+00,  3.40717514e+00,
     4.26140953e+00,  3.99027610e+00,  4.95355392e+00,
     4.39413021e+00,  5.82777977e+00],
   [ 3.40058788e+00,  4.17031362e+00,  3.19562104e+00,
     4.39211658e+00,  3.71654308e+00,  5.08000660e+00,
     4.03249828e+00,  5.98969958e+00],
   [ 3.20710115e+00,  4.24250197e+00,  2.97352800e+00,
     4.51051648e+00,  3.43164539e+00,  5.17895746e+00,
     3.65618964e+00,  6.11541295e+00],
   [ 2.99249172e+00,  4.29739455e+00,  2.74241730e+00,
     4.61800909e+00,  3.13834643e+00,  5.24928498e+00,
     3.28420114e+00,  6.20117542e+00],
   [ 2.77088576e+00,  4.33446247e+00,  2.50321655e+00,
     4.71540311e+00,  2.84025156e+00,  5.29496098e+00,
     2.90961737e+00,  6.25545948e+00],
   [ 2.52245993e+00,  4.35383328e+00,  2.25676676e+00,
     4.80348093e+00,  2.53946900e+00,  5.31668305e+00,
     2.55647808e+00,  6.27953283e+00],
   [ 2.24205020e+00,  4.35902128e+00,  2.00354626e+00,
     4.88261221e+00,  2.23781097e+00,  5.32201195e+00,
     2.23357174e+00,  6.28500262e+00],
   [ 1.93494747e+00,  4.35768409e+00,  1.74398620e+00,
     4.95312932e+00,  1.93603402e+00,  5.32068348e+00,
     1.93712058e+00,  6.28368287e+00],
   [ 1.63428748e+00,  4.35802299e+00,  1.47850069e+00,
     5.01536336e+00,  1.63428748e+00,  5.32102394e+00,
     1.63428748e+00,  6.28402299e+00],
   [ 1.33253449e+00,  4.35805052e+00,  1.20752918e+00,
     5.06970408e+00,  1.33253449e+00,  5.32102203e+00,
     1.33253449e+00,  6.28405052e+00],
   [ 1.03078246e+00,  4.35810000e+00,  9.31580694e-01,
     5.11667080e+00,  1.03078246e+00,  5.32107902e+00,
     1.03078246e+00,  6.28410000e+00],
   [ 7.29030728e-01,  4.35814208e+00,  6.51246559e-01,
     5.15694448e+00,  7.29030728e-01,  5.32112098e+00,
     7.29030728e-01,  6.28414208e+00],
   [ 4.27278861e-01,  4.35818559e+00,  3.67158808e-01,
     5.19131949e+00,  4.27278861e-01,  5.32116318e+00,
     4.27278861e-01,  6.28418559e+00],
   [ 1.25526853e-01,  4.35822600e+00,  7.99454147e-02,
     5.22064326e+00,  1.25526853e-01,  5.32120800e+00,
     1.25526853e-01,  6.28422600e+00],
   [-1.76224597e-01,  4.35828751e+00, -2.09794177e-01,
     5.24577850e+00, -1.76224597e-01,  5.32124400e+00,
    -1.76224597e-01,  6.28428751e+00],
   [-4.77978393e-01,  4.35829097e+00, -5.01496769e-01,
     5.26758559e+00, -4.77978393e-01,  5.32133102e+00,
    -4.77978393e-01,  6.28429097e+00],
   [-7.81223548e-01,  4.35825208e+00, -7.94633921e-01,
     5.28691584e+00, -7.79723197e-01,  5.32125092e+00,
    -7.78222847e-01,  6.28424975e+00],
   [-1.08079976e+00,  4.35872133e+00, -1.08870579e+00,
     5.30461053e+00, -1.08149600e+00,  5.32172108e+00,
    -1.08219224e+00,  6.28472083e+00],
   [-1.38323247e+00,  4.35850292e+00, -1.38323247e+00,
     5.32150292e+00, -1.38323247e+00,  5.32150292e+00,
    -1.38323247e+00,  6.28450292e+00],
   [-1.26043263e+00,  4.36636461e+00, -1.38323247e+00,
     5.32150292e+00, -1.38323247e+00,  5.32150292e+00,
    -1.50603232e+00,  6.27664124e+00],
   [-1.46962715e+00,  4.34382446e+00, -1.57218796e+00,
     5.15833926e+00, -1.68224502e+00,  5.28305960e+00,
    -1.89486288e+00,  6.22229474e+00],
   [-1.66139036e+00,  4.30645469e+00, -1.75943411e+00,
     4.99471599e+00, -1.97644007e+00,  5.21646166e+00,
    -2.29148978e+00,  6.12646863e+00],
   [-1.88382829e+00,  4.23192404e+00, -1.94325192e+00,
     4.83017884e+00, -2.26154244e+00,  5.11775756e+00,
    -2.63925659e+00,  6.00359108e+00],
   [-2.10170847e+00,  4.14145220e+00, -2.12196828e+00,
     4.66430273e+00, -2.53887844e+00,  4.99950314e+00,
    -2.97604841e+00,  5.85755408e+00],
   [-2.30051900e+00,  4.04392141e+00, -2.29393675e+00,
     4.49669672e+00, -2.80769348e+00,  4.86254406e+00,
    -3.31486796e+00,  5.68116671e+00],
   [-2.49027671e+00,  3.93032288e+00, -2.45753815e+00,
     4.32701600e+00, -3.06410849e+00,  4.70368314e+00,
    -3.63794027e+00,  5.47704339e+00],
   [-2.66598657e+00,  3.80470312e+00, -2.61111989e+00,
     4.15496145e+00, -3.30635655e+00,  4.52393556e+00,
    -3.94672653e+00,  5.24316799e+00],
   [-2.81937683e+00,  3.67522297e+00, -2.75287574e+00,
     3.98027147e+00, -3.53155243e+00,  4.32343197e+00,
    -4.24372804e+00,  4.97164097e+00],
   [-2.94861707e+00,  3.54387546e+00, -2.88074727e+00,
     3.80273080e+00, -3.73442507e+00,  4.10053945e+00,
    -4.52023307e+00,  4.65720343e+00],
   [-3.04645678e+00,  3.42563276e+00, -2.99242169e+00,
     3.62221586e+00, -3.90861416e+00,  3.85464752e+00,
    -4.77077153e+00,  4.28366227e+00],
   [-3.11470475e+00,  3.32813286e+00, -3.08463541e+00,
     3.43867195e+00, -4.04284286e+00,  3.58489859e+00,
    -4.97098098e+00,  3.84166432e+00],
   [-3.16334305e+00,  3.21622045e+00, -3.15418862e+00,
     3.25242287e+00, -4.12314606e+00,  3.29462445e+00,
    -5.08294906e+00,  3.37302845e+00],
   [-3.18634499e+00,  3.05056747e+00, -3.19725036e+00,
     3.06423409e+00, -4.14769101e+00,  2.99415100e+00,
    -5.10903704e+00,  2.93773452e+00],
   [-3.18368963e+00,  2.87153023e+00, -3.20877812e+00,
     2.87561666e+00, -4.13002789e+00,  2.69316852e+00,
    -5.07636615e+00,  2.51480681e+00],
   [-3.18138122e+00,  2.75801262e+00, -3.18111559e+00,
     2.68964629e+00, -4.07425606e+00,  2.39725852e+00,
    -4.96713090e+00,  2.03650443e+00],
   [-3.18015747e+00,  2.68108619e+00, -3.10307263e+00,
     2.51360992e+00, -3.96148801e+00,  2.11815494e+00,
    -4.74281855e+00,  1.55522369e+00],
   [-3.15873450e+00,  2.60508448e+00, -2.99524681e+00,
     2.34717162e+00, -3.78564501e+00,  1.87409049e+00,
    -4.41255552e+00,  1.14309650e+00],
   [-3.09601103e+00,  2.52354436e+00, -2.86141759e+00,
     2.19096973e+00, -3.55716050e+00,  1.67813903e+00,
    -4.01830997e+00,  8.32733703e-01],
   [-2.96048707e+00,  2.43774822e+00, -2.70484075e+00,
     2.04510762e+00, -3.29260957e+00,  1.53383249e+00,
    -3.62473208e+00,  6.29916764e-01],
   [-2.78103635e+00,  2.36532046e+00, -2.52864314e+00,
     1.90919843e+00, -3.00952351e+00,  1.42981920e+00,
    -3.23801067e+00,  4.94317932e-01],
   [-2.57415280e+00,  2.31066552e+00, -2.33556059e+00,
     1.78262993e+00, -2.71642852e+00,  1.35823357e+00,
    -2.85870424e+00,  4.05801621e-01],
   [-2.31934137e+00,  2.27158535e+00, -2.12848562e+00,
     1.66434980e+00, -2.41796899e+00,  1.31364924e+00,
    -2.51659661e+00,  3.55713126e-01],
   [-2.07115574e+00,  2.24463527e+00, -1.91062718e+00,
     1.55278830e+00, -2.11819208e+00,  1.28278467e+00,
    -2.16522841e+00,  3.20934067e-01],
   [-1.77037664e+00,  2.22992641e+00, -1.68570887e+00,
     1.44577085e+00, -1.81680852e+00,  1.26804644e+00,
    -1.86324040e+00,  3.06166467e-01],
   [-1.46816720e+00,  2.21533781e+00, -1.45726768e+00,
     1.34105971e+00, -1.51540703e+00,  1.25349718e+00,
    -1.56264685e+00,  2.91656552e-01],
   [-1.20553623e+00,  2.20165724e+00, -1.23298581e+00,
     1.23601102e+00, -1.21401352e+00,  1.23869455e+00,
    -1.22249080e+00,  2.75731862e-01],
   [-9.12904751e-01,  2.19903857e+00, -1.01302378e+00,
     1.12865840e+00, -9.12331998e-01,  1.23603874e+00,
    -9.11759246e-01,  2.73038915e-01],
   [-6.10580087e-01,  2.19923225e+00, -7.99366450e-01,
     1.01799834e+00, -6.10580087e-01,  1.23621821e+00,
    -6.10580087e-01,  2.73232251e-01],
   [-2.53144251e-01,  2.19763454e+00, -5.94293089e-01,
     9.02942960e-01, -3.08836594e-01,  1.23624629e+00,
    -3.64528937e-01,  2.74858040e-01],
   [ 2.09748043e-01,  2.15690087e+00, -3.99894292e-01,
     7.82608035e-01, -7.86954910e-03,  1.21881154e+00,
    -2.25487141e-01,  2.80722216e-01],
   [ 6.55102127e-01,  2.04002824e+00, -2.18057460e-01,
     6.56344504e-01,  2.85629354e-01,  1.15072578e+00,
    -8.38434183e-02,  2.61423319e-01],
   [ 1.09582423e+00,  1.83781673e+00, -5.09678338e-02,
     5.23541945e-01,  5.63661560e-01,  1.03521353e+00,
     3.14988947e-02,  2.32610330e-01],
   [ 1.49311454e+00,  1.55225166e+00,  9.89444646e-02,
     3.83735270e-01,  8.14773872e-01,  8.68714571e-01,
     1.36433210e-01,  1.85177487e-01],
   [ 1.81820594e+00,  1.20777277e+00,  2.29262616e-01,
     2.36785620e-01,  1.02858922e+00,  6.56524703e-01,
     2.38972494e-01,  1.05276639e-01],
   [ 2.07052390e+00,  8.23411423e-01,  3.37290625e-01,
     8.28500646e-02,  1.20095527e+00,  4.09624755e-01,
     3.31386647e-01, -4.16191199e-03],
   [ 2.25301170e+00,  4.13548569e-01,  4.19830037e-01,
    -7.75320588e-02,  1.33038849e+00,  1.37622124e-01,
     4.07765272e-01, -1.38304322e-01],
   [ 2.37323832e+00, -3.93445394e-02,  4.72886056e-01,
    -2.43243283e-01,  1.41675067e+00, -1.51149599e-01,
     4.60263017e-01, -2.62954658e-01],
   [ 2.39677193e+00, -6.35296681e-01,  4.89445706e-01,
    -4.12163389e-01,  1.45171484e+00, -4.50266659e-01,
     5.06657760e-01, -2.65236637e-01],
   [ 2.29992834e+00, -1.07218001e+00,  4.61242206e-01,
    -5.79245103e-01,  1.39376962e+00, -7.46226966e-01,
     4.87610909e-01, -4.20273923e-01],
   [ 2.13178653e+00, -1.50071196e+00,  3.98397402e-01,
    -7.40524796e-01,  1.29174080e+00, -1.02986997e+00,
     4.51695076e-01, -5.59027990e-01],
   [ 1.88558653e+00, -1.90752265e+00,  3.05970185e-01,
    -8.94191814e-01,  1.14448577e+00, -1.29259285e+00,
     4.03385009e-01, -6.77663053e-01],
   [ 1.56023540e+00, -2.27106638e+00,  1.86993659e-01,
    -1.03901222e+00,  9.52284396e-01, -1.52423000e+00,
     3.44333391e-01, -7.77393625e-01],
   [ 1.16763607e+00, -2.56628075e+00,  4.40897103e-02,
    -1.17419486e+00,  7.18870655e-01, -1.71423697e+00,
     2.70105236e-01, -8.62193197e-01],
   [ 7.15970907e-01, -2.78083482e+00, -1.20748632e-01,
    -1.29909829e+00,  4.52312991e-01, -1.85463101e+00,
     1.88655075e-01, -9.28427194e-01],
   [ 2.80952870e-01, -2.89281008e+00, -3.04850986e-01,
    -1.41378625e+00,  1.62548039e-01, -1.93711698e+00,
     4.41432083e-02, -9.81423883e-01],
   [-1.39464502e-01, -2.93716956e+00, -5.06114033e-01,
    -1.51839291e+00, -1.36553798e-01, -1.97417396e+00,
    -1.33643093e-01, -1.01117836e+00],
   [-4.30609616e-01, -2.93622958e+00, -7.22250087e-01,
    -1.61346564e+00, -4.38446850e-01, -1.97326148e+00,
    -4.46284083e-01, -1.01029337e+00],
   [-7.34685792e-01, -2.93870145e+00, -9.50764772e-01,
    -1.70001000e+00, -7.40160406e-01, -1.97571701e+00,
    -7.45635020e-01, -1.01273257e+00],
   [-1.03596321e+00, -2.94041411e+00, -1.18891860e+00,
    -1.77952996e+00, -1.04191351e+00, -1.97743249e+00,
    -1.04786381e+00, -1.01445087e+00],
   [-1.33779593e+00, -2.94227914e+00, -1.43368883e+00,
    -1.85403422e+00, -1.34365851e+00, -1.97929698e+00,
    -1.34952109e+00, -1.01631483e+00],
   [-1.63952644e+00, -2.94411605e+00, -1.68185501e+00,
    -1.92590378e+00, -1.64540499e+00, -1.98113400e+00,
    -1.65128355e+00, -1.01815194e+00],
   [-1.94128281e+00, -2.94595814e+00, -1.92952923e+00,
    -2.00120267e+00, -1.94715148e+00, -1.98297602e+00,
    -1.95302016e+00, -1.01999390e+00],
   [-2.24298855e+00, -2.94779681e+00, -2.17218218e+00,
    -2.08042033e+00, -2.24889755e+00, -1.98481494e+00,
    -2.25480656e+00, -1.02183307e+00],
   [-2.54499147e+00, -2.94964991e+00, -2.40813972e+00,
    -2.16467978e+00, -2.55064344e+00, -1.98666650e+00,
    -2.55629542e+00, -1.02368309e+00],
   [-2.84505319e+00, -2.95140957e+00, -2.63568914e+00,
    -2.25502109e+00, -2.85239196e+00, -1.98843753e+00,
    -2.85973073e+00, -1.02546550e+00],
   [-3.15739430e+00, -2.95373147e+00, -2.85324631e+00,
    -2.35225975e+00, -3.15412402e+00, -1.99073702e+00,
    -3.15085375e+00, -1.02774257e+00],
   [-3.39290901e+00, -2.95064563e+00, -3.05943882e+00,
    -2.45692280e+00, -3.45596099e+00, -1.98971200e+00,
    -3.51901297e+00, -1.02877837e+00],
   [-3.48092751e+00, -2.93209872e+00, -3.25305710e+00,
    -2.56929135e+00, -3.75676692e+00, -2.00944948e+00,
    -4.03260632e+00, -1.08680024e+00],
   [-3.57124364e+00, -2.93400554e+00, -3.43272801e+00,
    -2.68959938e+00, -4.04507887e+00, -2.09564453e+00,
    -4.51891411e+00, -1.25728353e+00],
   [-3.66790610e+00, -2.96400812e+00, -3.59702958e+00,
    -2.81794994e+00, -4.30712044e+00, -2.24374843e+00,
    -4.94633478e+00, -1.52348873e+00],
   [-3.77346822e+00, -3.03641515e+00, -3.74306994e+00,
    -2.95491058e+00, -4.53251886e+00, -2.44378448e+00,
    -5.29156951e+00, -1.85115380e+00],
   [-3.87635742e+00, -3.14932312e+00, -3.86836934e+00,
    -3.10040213e+00, -4.71801949e+00, -2.68137658e+00,
    -5.55968155e+00, -2.21343003e+00],
   [-3.96419109e+00, -3.28666635e+00, -3.96989972e+00,
    -3.25404934e+00, -4.86444402e+00, -2.94473994e+00,
    -5.76469694e+00, -2.60281353e+00],
   [-4.03178556e+00, -3.43734829e+00, -4.04348549e+00,
    -3.41507854e+00, -4.97136140e+00, -3.22624111e+00,
    -5.91093724e+00, -3.01513393e+00],
   [-4.07444746e+00, -3.52619950e+00, -4.08361273e+00,
    -3.58173641e+00, -5.03742933e+00, -3.52029002e+00,
    -6.00041120e+00, -3.51438053e+00],
   [-4.09274980e+00, -3.64299052e+00, -4.08108776e+00,
    -3.74989808e+00, -5.03927088e+00, -3.82037950e+00,
    -5.98579196e+00, -3.99776847e+00],
   [-4.06905659e+00, -3.81559260e+00, -4.05244809e+00,
    -3.91605405e+00, -4.98369145e+00, -4.11694300e+00,
    -5.89832632e+00, -4.41829341e+00],
   [-4.03441098e+00, -3.96003587e+00, -3.99600646e+00,
    -4.07814928e+00, -4.88936806e+00, -4.40322590e+00,
    -5.74432513e+00, -4.84641593e+00],
   [-4.00010118e+00, -4.06734163e+00, -3.90883293e+00,
    -4.23316371e+00, -4.75082994e+00, -4.67047954e+00,
    -5.50155869e+00, -5.27361744e+00],
   [-3.96249114e+00, -4.15172628e+00, -3.79476512e+00,
    -4.37962043e+00, -4.56235838e+00, -4.90507102e+00,
    -5.16222562e+00, -5.65841576e+00],
   [-3.90725985e+00, -4.22578061e+00, -3.65529532e+00,
    -4.51594448e+00, -4.32696509e+00, -5.09250808e+00,
    -4.74667034e+00, -5.95923555e+00],
   [-3.81887827e+00, -4.29035432e+00, -3.49221662e+00,
    -4.64093696e+00, -4.05607045e+00, -5.22368646e+00,
    -4.29326262e+00, -6.15701859e+00],
   [-3.68427195e+00, -4.33818069e+00, -3.30754560e+00,
    -4.75380890e+00, -3.76421702e+00, -5.29785657e+00,
    -3.84416209e+00, -6.25753244e+00],
   [-3.46259942e+00, -4.35988575e+00, -3.10344461e+00,
    -4.85419037e+00, -3.46377051e+00, -5.32288504e+00,
    -3.46494160e+00, -6.28588432e+00],
   [-3.17590736e+00, -4.36035176e+00, -2.88214726e+00,
    -4.94211653e+00, -3.16204405e+00, -5.32325196e+00,
    -3.14818073e+00, -6.28615217e+00],
   [-2.86114062e+00, -4.35590654e+00, -2.64588890e+00,
    -5.01799195e+00, -2.86019254e+00, -5.31890607e+00,
    -2.85924446e+00, -6.28190560e+00],
   [-2.55844808e+00, -4.35558873e+00, -2.39683946e+00,
    -5.08253112e+00, -2.55844808e+00, -5.31860900e+00,
    -2.55844808e+00, -6.28158873e+00],
   [-2.25886351e+00, -4.35557087e+00, -2.13703369e+00,
    -5.13667066e+00, -2.25671101e+00, -5.31856847e+00,
    -2.25455850e+00, -6.28156606e+00],
   [-1.95701166e+00, -4.35489617e+00, -1.86805609e+00,
    -5.18117895e+00, -1.95495653e+00, -5.31789398e+00,
    -1.95290140e+00, -6.28089179e+00],
   [-1.65495627e+00, -4.35425161e+00, -1.59117393e+00,
    -5.21663936e+00, -1.65320396e+00, -5.31725001e+00,
    -1.65145166e+00, -6.28024842e+00],
   [-1.35325196e+00, -4.35370262e+00, -1.30773622e+00,
    -5.24365176e+00, -1.35145247e+00, -5.31670094e+00,
    -1.34965298e+00, -6.27969925e+00],
   [-1.05154332e+00, -4.35313884e+00, -1.01948874e+00,
    -5.26281429e+00, -1.04970199e+00, -5.31613708e+00,
    -1.04786066e+00, -6.27913532e+00],
   [-7.49779471e-01, -4.35256184e+00, -7.28367605e-01,
    -5.27436868e+00, -7.47950315e-01, -5.31556010e+00,
    -7.46121160e-01, -6.27855837e+00],
   [-4.48025769e-01, -4.35198868e+00, -4.36251857e-01,
    -5.27840198e+00, -4.46198896e-01, -5.31498694e+00,
    -4.44372022e-01, -6.27798521e+00],
   [-1.46277467e-01, -4.35141624e+00, -1.44740572e-01,
    -5.27478662e+00, -1.44447550e-01, -5.31441450e+00,
    -1.42617633e-01, -6.27741276e+00],
   [ 1.55481487e-01, -4.35084283e+00,  1.44998356e-01,
    -5.26378176e+00,  1.57303795e-01, -5.31384110e+00,
     1.59126103e-01, -6.27683938e+00],
   [ 4.57242024e-01, -4.35027180e+00,  4.32043951e-01,
    -5.24524165e+00,  4.59055200e-01, -5.31327009e+00,
     4.60868377e-01, -6.27626839e+00],
   [ 7.58943369e-01, -4.34970374e+00,  7.15610424e-01,
    -5.21894850e+00,  7.60806769e-01, -5.31270194e+00,
     7.62670169e-01, -6.27570014e+00],
   [ 1.06066591e+00, -4.34911991e+00,  9.95024553e-01,
    -5.18467299e+00,  1.06255746e+00, -5.31211805e+00,
     1.06444901e+00, -6.27511620e+00],
   [ 1.36276390e+00, -4.34852658e+00,  1.26980482e+00,
    -5.14235071e+00,  1.36430848e+00, -5.31152534e+00,
     1.36585305e+00, -6.27452411e+00],
   [ 1.66444339e+00, -4.34804272e+00,  1.53939884e+00,
    -5.09167135e+00,  1.66606253e+00, -5.31104136e+00,
     1.66768168e+00, -6.27403999e+00],
   [ 1.96396191e+00, -4.34754171e+00,  1.80339511e+00,
    -5.03247957e+00,  1.96781600e+00, -5.31053400e+00,
     1.97167008e+00, -6.27352629e+00],
   [ 2.26784234e+00, -4.34632792e+00,  2.06166063e+00,
    -4.96496719e+00,  2.26954746e+00, -5.30932641e+00,
     2.27125259e+00, -6.27232490e+00],
   [ 2.58346153e+00, -4.34586891e+00,  2.31386830e+00,
    -4.88900241e+00,  2.57130003e+00, -5.30879211e+00,
     2.55913853e+00, -6.27171532e+00],
   [ 2.86064720e+00, -4.34968658e+00,  2.55962552e+00,
    -4.80435898e+00,  2.87318909e+00, -5.31260490e+00,
     2.88573098e+00, -6.27552323e+00],
   [ 3.08434097e+00, -4.34993734e+00,  2.79848978e+00,
    -4.71074357e+00,  3.17483497e+00, -5.30867600e+00,
     3.26532897e+00, -6.26741467e+00],
   [ 3.24738848e+00, -4.34461611e+00,  3.02937532e+00,
    -4.60707488e+00,  3.47491241e+00, -5.28035212e+00,
     3.70243633e+00, -6.21608812e+00],
   [ 3.39025229e+00, -4.32319901e+00,  3.25112961e+00,
    -4.49228707e+00,  3.76761901e+00, -5.20918059e+00,
     4.14498573e+00, -6.09516217e+00],
   [ 3.52952983e+00, -4.27759291e+00,  3.46200399e+00,
    -4.36472690e+00,  4.04491305e+00, -5.09107256e+00,
     4.56029627e+00, -5.90455221e+00],
   [ 3.66611515e+00, -4.20435740e+00,  3.65978282e+00,
    -4.22241224e+00,  4.29937792e+00, -4.92985535e+00,
     4.93264068e+00, -5.65535329e+00],
   [ 3.78348868e+00, -4.11893028e+00,  3.84055793e+00,
    -4.06189338e+00,  4.52632952e+00, -4.73175693e+00,
     5.26917035e+00, -5.34458357e+00],
   [ 3.88465443e+00, -4.01689150e+00,  3.99861424e+00,
    -3.87879571e+00,  4.71813655e+00, -4.49925709e+00,
     5.55161867e+00, -4.98162267e+00],
   [ 3.97033680e+00, -3.89252486e+00,  4.13911869e+00,
    -3.67949499e+00,  4.86903286e+00, -4.23852253e+00,
     5.76772892e+00, -4.58452020e+00],
   [ 4.03366469e+00, -3.76505138e+00,  4.26396954e+00,
    -3.46646164e+00,  4.97725320e+00, -3.95743048e+00,
     5.92084171e+00, -4.14980959e+00],
   [ 4.07607337e+00, -3.60638597e+00,  4.37521581e+00,
    -3.24200082e+00,  5.03745842e+00, -3.66213357e+00,
     5.99884346e+00, -3.71788118e+00],
   [ 4.09191911e+00, -3.36335638e+00,  4.47407468e+00,
    -3.00754094e+00,  5.05491638e+00, -3.36106551e+00,
     6.01791366e+00, -3.35877464e+00],
   [ 4.09124973e+00, -3.06922923e+00,  4.56184087e+00,
    -2.76447573e+00,  5.05419850e+00, -3.05929601e+00,
     6.01714727e+00, -3.04936279e+00],
   [ 4.08808542e+00, -2.75656077e+00,  4.63935249e+00,
    -2.51378477e+00,  5.05108500e+00, -2.75746548e+00,
     6.01408457e+00, -2.75837019e+00],
   [ 4.08836965e+00, -2.45421670e+00,  4.70720667e+00,
    -2.25625395e+00,  5.05136847e+00, -2.45572102e+00,
     6.01436730e+00, -2.45722534e+00],
   [ 4.08879489e+00, -2.15398109e+00,  4.76588939e+00,
    -1.99260164e+00,  5.05183983e+00, -2.15398109e+00,
     6.01479489e+00, -2.15398109e+00],
   [ 4.08870405e+00, -1.85222751e+00,  4.81582875e+00,
    -1.72353732e+00,  5.05174994e+00, -1.85222751e+00,
     6.01470405e+00, -1.85222751e+00],
   [ 4.08865660e+00, -1.55047351e+00,  4.85741093e+00,
    -1.44978947e+00,  5.05165815e+00, -1.55047351e+00,
     6.01465660e+00, -1.55047351e+00],
   [ 4.08865052e+00, -1.24872249e+00,  4.89097206e+00,
    -1.17211620e+00,  5.05165505e+00, -1.24872249e+00,
     6.01465052e+00, -1.24872249e+00],
   [ 4.08863348e+00, -9.46970701e-01,  4.91678034e+00,
    -8.91307891e-01,  5.05164599e+00, -9.46970701e-01,
     6.01463348e+00, -9.46970701e-01],
   [ 4.08860904e+00, -6.45218700e-01,  4.93502458e+00,
    -6.08188621e-01,  5.05162096e+00, -6.45218700e-01,
     6.01460904e+00, -6.45218700e-01],
   [ 4.08858603e+00, -3.43466744e-01,  4.94580805e+00,
    -3.23614914e-01,  5.05159712e+00, -3.43466744e-01,
     6.01458603e+00, -3.43466744e-01],
   [ 4.08856350e+00, -4.17148415e-02,  4.94913896e+00,
    -3.84686815e-02,  5.05157495e+00, -4.17148415e-02,
     6.01456350e+00, -4.17148415e-02],
   [ 4.08854049e+00,  2.60037050e-01,  4.94467385e+00,
     2.46312783e-01,  5.05155206e+00,  2.60037050e-01,
     6.01454049e+00,  2.60037050e-01],
   [ 4.08851999e+00,  5.61788946e-01,  4.93245786e+00,
     5.29814738e-01,  5.05152893e+00,  5.61788946e-01,
     6.01451999e+00,  5.61788946e-01],
   [ 4.08849949e+00,  8.63541037e-01,  4.91250749e+00,
     8.11260211e-01,  5.05151105e+00,  8.63541037e-01,
     6.01449949e+00,  8.63541037e-01]])
    x = params['x']
    y = params['y']
    next_index=params['closest_waypoints'][1]
    progress=params['progress']
    steps=params['steps']
    track_length=params['track_length']
    heading=params['heading']
    steering_angle=params['steering_angle']
    stepsK = round(2.5 * track_length/18,1)
    track_width = params['track_width']
    speed = params['speed']
    reward_base = 1e-2
    curPoint = (x,y)
    def loadWayPoint(waypointList):
        inner_line = waypointList[:,0:2]
        race_line = waypointList[:,2:4]
        center_line = waypointList[:,4:6]
        outer_line = waypointList[:,6:8]
        return inner_line,race_line,center_line,outer_line
    def menger_curvature(pt1, pt2, pt3, atol=1e-3):
        vec21 = np.array([pt1[0]-pt2[0], pt1[1]-pt2[1]])
        vec23 = np.array([pt3[0]-pt2[0], pt3[1]-pt2[1]])
        norm21 = np.linalg.norm(vec21)
        norm23 = np.linalg.norm(vec23)
        if np.abs(np.dot(vec21, vec23)) < atol and norm21*norm23 < atol:
            return 0
        theta = np.arccos(np.dot(vec21, vec23)/(norm21*norm23))
        if np.abs(theta-np.pi) < atol:
            theta = 0.0
        dist13 = np.linalg.norm(vec21-vec23)
        if np.abs(dist13) < atol:
            return 0
        return 2*np.sin(theta) / dist13
    def getDistanceBy2Point(point1,point2):
        x1,y1 = point1
        x2,y2 = point2
        vec = (x2-x1,y2-y1)
        distance = np.sqrt(vec[0]**2+vec[1]**2)
        return distance
    def getDistanceByLineAndPoint(line,point,thold=1e-3):
        p1,p2 = line
        x1,y1 = p1
        x2,y2 = p2
        x3,y3 = point
        if np.abs(x1-x2) < thold and np.abs(y1-y2) < thold:
            return getDistanceBy2Point(((x1+x2)/2,(y1+y2)/2),point)
        elif np.abs(x1-x2) < thold:
            x_ = (x1+x2)/2
            return np.abs(x_-x3)
        elif np.abs(y1-y2) < thold:
            y_ = (y1+y2)/2
            return np.abs(y_-y3)
        else:
            return np.abs((y2-y1)*x3 - (x2-x1)*y3 + x2*y1 - x1*y2) / np.sqrt((y2-y1)**2 + (x2-x1)**2)
    def stepRewardK(progress,steps,stepsK,k=0):
        if progress < 5:
            k = 0.5
        else:
            k = float(progress * stepsK/steps)
            k = 2.5 if k > 2.5 else k
        ret = exp(k**2)
        return ret
    def positionRewardK(curPoint,next_index,speed,track_width,race_line,mode,heading,delta=3,k=0,tholdAngle=1e-5,angleThold = 15):
        line = (race_line[next_index%mode],race_line[(next_index+1)%mode])
        distance = getDistanceByLineAndPoint(line,curPoint,thold=1e-3)
        k  = 0.7 - distance * 2.0/track_width
        k = -0.1 if k < -0.1 else k
        next_point = race_line[(next_index+delta)%mode]
        next_point2 = race_line[(next_index+delta*2)%mode]
        deltaX = next_point2[0] - next_point[0]
        deltaY = next_point2[1] - next_point[1]
        direct = 0
        if np.abs(deltaX) < tholdAngle:
            track_direction = np.sign(deltaX) * np.pi/2
        if deltaX > tholdAngle:
            if deltaY > tholdAngle:
                direct = 1
                track_direction = math.atan2(deltaY,deltaX)
            else:
                direct = 4
                track_direction = math.atan2(deltaY,deltaX) + np.pi
        else:
            if deltaY > tholdAngle:
                direct = 2
                track_direction = math.atan2(deltaY,deltaX) + np.pi
            else:
                direct = 3
                track_direction = math.atan2(deltaY,deltaX) + np.pi
        # Convert to degree
        track_direction = math.degrees(track_direction)
        heading = heading if heading > 0 else heading + 360
        direction_diff = abs(track_direction - heading)
        angleK = direction_diff/angleThold
        angleK = 2 if angleK > 2 else angleK
        c = menger_curvature(curPoint, next_point, next_point2, atol=1e-3)
        
        vmax = 1.4**2 * 1.3 /(c+0.2)
        vmax = 4 if vmax > 4 else vmax
        if k > 0:
            if speed < vmax:
                ret = exp((speed/1.6)**2 * (1-angleK))
            else:
                ret = exp((speed/2)**2 * (1-angleK)) - exp((vmax/2)**2 * (1-angleK))
        else:
            if speed < vmax:
                ret = exp((speed/2)**2 * (angleK-1))
            else:
                ret = exp((speed/1.6)**2 * (angleK-1)) - exp((vmax/1.6)**2 * (angleK-1))
        ret *= 8*k
        return distance,ret
    inner_line,race_line,center_line,outer_line = loadWayPoint(waypointList)
    mode = len(race_line)-1
    k1 = stepRewardK(progress,steps,stepsK)
    distance,k2 = positionRewardK(curPoint,next_index,speed,track_width,race_line,mode,heading)
    reward = float(reward_base * (k1 + k2))
    print(f'LOG_DATA:{x},{y},{distance},{progress},{steps},{next_index},{speed},{k1},{k2},{track_width},{reward}')
    return reward

